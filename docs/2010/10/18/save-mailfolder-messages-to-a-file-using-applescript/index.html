<!DOCTYPE html>
<html lang="en"><head>
	
	<meta name="generator" content="Hugo 0.73.0" />
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="keywords" content="hugo,vitae,theme,static"><meta name="description" content=""><meta property="og:title" content="save mailfolder messages to a file using applescript" />
<meta property="og:description" content="I&rsquo;ll just start by explaining that I hate applescript. I wanted to create a script that would take a specific folder withing the script and save each message from that folder to a text file on my machine for post-processing.
This is what I came up with.
set fileRoot to &#34;Macintosh HD:Users:path:&#34; set messageList to {} tell application &#34;Mail&#34; set messageList to messageList &amp; (messages of mailbox &#34;mailbox name&#34; of account &#34;account&#34; of application &#34;Mail&#34;) set counter to 1 repeat with theMessage in messageList set fileNum to counter as string set theFilePath to fileRoot &amp; &#34;mailcontent&#34; &amp; fileNum &amp; &#34;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://partiallyattended.com/2010/10/18/save-mailfolder-messages-to-a-file-using-applescript/" />
<meta property="article:published_time" content="2010-10-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2010-10-18T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="save mailfolder messages to a file using applescript"/>
<meta name="twitter:description" content="I&rsquo;ll just start by explaining that I hate applescript. I wanted to create a script that would take a specific folder withing the script and save each message from that folder to a text file on my machine for post-processing.
This is what I came up with.
set fileRoot to &#34;Macintosh HD:Users:path:&#34; set messageList to {} tell application &#34;Mail&#34; set messageList to messageList &amp; (messages of mailbox &#34;mailbox name&#34; of account &#34;account&#34; of application &#34;Mail&#34;) set counter to 1 repeat with theMessage in messageList set fileNum to counter as string set theFilePath to fileRoot &amp; &#34;mailcontent&#34; &amp; fileNum &amp; &#34;."/>

	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/all.css" />
	<link rel="stylesheet" href="/css/katex.min.css" crossorigin="anonymous">
	<script defer src="/js/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
	<script defer src="/js/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><title>save mailfolder messages to a file using applescript | Partially Attended</title></head>
<body><header>
	
	<div id="titletext"><h2 id="title"><a href="http://partiallyattended.com">Partially Attended</a></h2></div>
	<div id="title-description"><p id="subtitle">an irregularly updated blog by Ian Mulvany</p><div id="social">
			<nav>
				<ul>
					<li><a href="https://github.com/dataCobra/hugo-vitae"><i title="Github" class="icons fab fa-github"></i></a></li>
					<li><a href="/index.xml"><i title="RSS" class="icons fas fa-rss"></i></a></li></ul>
			</nav>
		</div>
	</div>
	
	<div id="mainmenu">
		<nav>
			<ul>
				
				<li><a href="/">Home</a></li>
				
				<li><a href="/about">About</a></li>
				
				<li><a href="/categories">Posts by Tag</a></li>
				
				<li><a href="/tags">Tags</a></li>
				
				<li><a href="/post">All Posts</a></li>
				
			</ul>
		</nav>
	</div>
	
</header>
<main>

<article id="content">

<h1 class="post-title">save mailfolder messages to a file using applescript</h1>

<section>
      <h4 id="date"> Mon Oct 18, 2010 </h4>
      <h5 id="wordcount"> 594 Words </h5>
</section>

<div class="post-entry-tags">
                          Tags:
                           <a href="/categories/apple">apple</a>, <a href="/categories/mail">mail</a>, <a href="/categories/applescript">applescript</a>
</div>

<div>
          <p>I&rsquo;ll just start by explaining that I hate applescript. I wanted to create a script that would take a specific folder withing the script and save each message from that folder to a text file on my machine for post-processing.</p>
<p>This is what I came up with.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-applescript" data-lang="applescript"><span style="color:#080;font-weight:bold">set</span> <span style="color:#963">fileRoot</span> <span style="color:#080;font-weight:bold">to</span> <span style="background-color:#fff0f0">&#34;Macintosh HD:Users:path:&#34;</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">messageList</span> <span style="color:#080;font-weight:bold">to</span> {}
<span style="color:#080;font-weight:bold">tell</span> <span style="color:#007020">application</span> <span style="background-color:#fff0f0">&#34;Mail&#34;</span>
	<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">messageList</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">messageList</span> <span style="color:#333">&amp;</span> (<span style="color:#963">messages</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">mailbox</span> <span style="background-color:#fff0f0">&#34;mailbox name&#34;</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">account</span> <span style="background-color:#fff0f0">&#34;account&#34;</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#007020">application</span> <span style="background-color:#fff0f0">&#34;Mail&#34;</span>)
	<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">counter</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#00d;font-weight:bold">1</span>
	<span style="color:#080;font-weight:bold">repeat</span> <span style="color:#080;font-weight:bold">with</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">in</span> <span style="color:#963">messageList</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">fileNum</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">counter</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">theFilePath</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">fileRoot</span> <span style="color:#333">&amp;</span> <span style="background-color:#fff0f0">&#34;mailcontent&#34;</span> <span style="color:#333">&amp;</span> <span style="color:#963">fileNum</span> <span style="color:#333">&amp;</span> <span style="background-color:#fff0f0">&#34;.txt&#34;</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">p</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">POSIX</span> <span style="color:#00c">path</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theFilePath</span>
		<span style="color:#007020">do shell script</span> <span style="background-color:#fff0f0">&#34;touch &#34;</span> <span style="color:#333">&amp;</span> <span style="color:#963">p</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">theFileReference</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#007020">open for access</span> <span style="color:#963">theFilePath</span> <span style="color:#080;font-weight:bold">with</span> <span style="color:#007020">write</span> <span style="color:#963">permission</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">messageText</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#00c">content</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">date</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
		<span style="color:#007020">write</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
		<span style="color:#007020">write</span> <span style="background-color:#fff0f0">&#34;\n&#34;</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
		<span style="color:#007020">write</span> <span style="color:#963">messageText</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
		<span style="color:#007020">close access</span> <span style="color:#963">theFileReference</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">counter</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">counter</span> <span style="color:#333">+</span> <span style="color:#00d;font-weight:bold">1</span>
	<span style="color:#080;font-weight:bold">end</span> <span style="color:#080;font-weight:bold">repeat</span>
<span style="color:#080;font-weight:bold">end</span> <span style="color:#080;font-weight:bold">tell</span></code></pre></div>
<p>It breaks down like this, the following script sets a list to be the messages in our names mailbox folder. We can then iterate over that array, getting attributes of each message, such as the message content or the sent date of the message:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-applescript" data-lang="applescript"><span style="color:#080;font-weight:bold">set</span> <span style="color:#963">messageList</span> <span style="color:#080;font-weight:bold">to</span> {}
<span style="color:#080;font-weight:bold">tell</span> <span style="color:#007020">application</span> <span style="background-color:#fff0f0">&#34;Mail&#34;</span>
	<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">messageList</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">messageList</span> <span style="color:#333">&amp;</span> (<span style="color:#963">messages</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">mailbox</span> <span style="background-color:#fff0f0">&#34;mailbox name&#34;</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">account</span> <span style="background-color:#fff0f0">&#34;account&#34;</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#007020">application</span> <span style="background-color:#fff0f0">&#34;Mail&#34;</span>)
	<span style="color:#080;font-weight:bold">repeat</span> <span style="color:#080;font-weight:bold">with</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">in</span> <span style="color:#963">messageList</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">messageText</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#00c">content</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
		<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">date</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
	<span style="color:#080;font-weight:bold">end</span> <span style="color:#080;font-weight:bold">repeat</span>
<span style="color:#080;font-weight:bold">end</span> <span style="color:#080;font-weight:bold">tell</span></code></pre></div>
<p>Taking the creation of the file root out of the loop, and also adding a looping variable out of the loop the content inside the loop now looks like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-applescript" data-lang="applescript"><span style="color:#080;font-weight:bold">set</span> <span style="color:#963">fileNum</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">counter</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">theFilePath</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">fileRoot</span> <span style="color:#333">&amp;</span> <span style="background-color:#fff0f0">&#34;mailcontent&#34;</span> <span style="color:#333">&amp;</span> <span style="color:#963">fileNum</span> <span style="color:#333">&amp;</span> <span style="background-color:#fff0f0">&#34;.txt&#34;</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">p</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">POSIX</span> <span style="color:#00c">path</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theFilePath</span>
<span style="color:#007020">do shell script</span> <span style="background-color:#fff0f0">&#34;touch &#34;</span> <span style="color:#333">&amp;</span> <span style="color:#963">p</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">theFileReference</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#007020">open for access</span> <span style="color:#963">theFilePath</span> <span style="color:#080;font-weight:bold">with</span> <span style="color:#007020">write</span> <span style="color:#963">permission</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">messageText</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#00c">content</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">date</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
<span style="color:#007020">write</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
<span style="color:#007020">write</span> <span style="background-color:#fff0f0">&#34;\n&#34;</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
<span style="color:#007020">write</span> <span style="color:#963">messageText</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
<span style="color:#007020">close access</span> <span style="color:#963">theFileReference</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">counter</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">counter</span> <span style="color:#333">+</span> <span style="color:#00d;font-weight:bold">1</span></code></pre></div>
<p>Looking in a bit more detail, we convert the counter (an int) into a string. We set the filepath to a base filename, the string version of the counter, and a file extension.  In order to ensure that the file exists we pass this path to a shell script, and &ldquo;touch&rdquo; the file. That&rsquo;s right, in order not to get fucked over by applescripts error handling, I&rsquo;ve just called out to the system shell as the most useful way of creating a filehandler to a file that might not extist. Jesus.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-applescript" data-lang="applescript"><span style="color:#080;font-weight:bold">set</span> <span style="color:#963">fileNum</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">counter</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">theFilePath</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">fileRoot</span> <span style="color:#333">&amp;</span> <span style="background-color:#fff0f0">&#34;mailcontent&#34;</span> <span style="color:#333">&amp;</span> <span style="color:#963">fileNum</span> <span style="color:#333">&amp;</span> <span style="background-color:#fff0f0">&#34;.txt&#34;</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">p</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">POSIX</span> <span style="color:#00c">path</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theFilePath</span>
<span style="color:#007020">do shell script</span> <span style="background-color:#fff0f0">&#34;touch &#34;</span> <span style="color:#333">&amp;</span> <span style="color:#963">p</span></code></pre></div>
<p>The second part of the loop now creates the file handler, writes some of the properties of the mail message into the file, closes the file handler, and iterates our loop counter.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-applescript" data-lang="applescript"><span style="color:#080;font-weight:bold">set</span> <span style="color:#963">theFileReference</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#007020">open for access</span> <span style="color:#963">theFilePath</span> <span style="color:#080;font-weight:bold">with</span> <span style="color:#007020">write</span> <span style="color:#963">permission</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">messageText</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#00c">content</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">date</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">of</span> <span style="color:#963">theMessage</span> <span style="color:#080;font-weight:bold">as </span><span style="color:#b06;font-weight:bold">string</span>
<span style="color:#007020">write</span> <span style="color:#963">sent</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
<span style="color:#007020">write</span> <span style="background-color:#fff0f0">&#34;\n&#34;</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
<span style="color:#007020">write</span> <span style="color:#963">messageText</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">theFileReference</span> <span style="color:#963">starting</span> <span style="color:#007020">at</span> <span style="color:#963">eof</span>
<span style="color:#007020">close access</span> <span style="color:#963">theFileReference</span>
<span style="color:#080;font-weight:bold">set</span> <span style="color:#963">counter</span> <span style="color:#080;font-weight:bold">to</span> <span style="color:#963">counter</span> <span style="color:#333">+</span> <span style="color:#00d;font-weight:bold">1</span></code></pre></div>

 </div>

<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>

 </article>



  </main>





</body>
</html>
