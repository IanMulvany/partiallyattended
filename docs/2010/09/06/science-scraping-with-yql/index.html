<htlml>
<head>
  <base href='http://partiallyattended.com'>
  
  <link rel='canonical' href='http://partiallyattended.com/2010/09/06/science-scraping-with-yql/'>
  <link href='' rel='alternate' type='application/rss+xml' title='Partially Attended' />
  <link rel='stylesheet' href="http://partiallyattended.com/css/styles.css" > 

</head>
</body>
<h2><a href="http://partiallyattended.com">home</a> |
  <a href="http://partiallyattended.com/categories">tags</a> |
  
  
  <a href="http://mulvany.net">mulvany.net</a></h2>
<hr/>


<h1 id="title">science scraping with YQL</h1>

<section>
      <h4 id="date"> Mon Sep 6, 2010 </h4>
      <h5 id="wordcount"> 255 Words </h5>
</section>

<div class="post-entry-tags">
                          Posted In:
                           <a href="/categories/yql">yql</a>, <a href="/categories/science">science</a>, <a href="/categories/scripting">scripting</a>, <a href="/categories/hacking">hacking</a>, <a href="/categories/cool">cool</a>, <a href="/categories/solo10">solo10</a>
</div>

<div>
       <article id="content">
          <p>Last Saturday at Science Online London I gave a quick tutorial on <a href="http://developer.yahoo.com/yql/">YQL</a>, and how it might be used to mash up scientific data sets.  Below I list some of the sample queries that I was playing with.  Before you get started with the <a href="http://developer.yahoo.com/yql/console/">console</a> have a look through the documentation.  I got a lot of milage out of the part about <a href="http://developer.yahoo.com/yql/guide/filters.html">filters</a> and <a href="http://developer.yahoo.com/yql/guide/joins.html">joins</a>.  The blog post by Paul Hogan on <a href="http://www.paulhagon.com/blog/2009/12/09/yql-mashups-for-libraries/">using YQL for library maships</a> was also very helpful.</p>

<p>In my presentation I was originally looking at extracing data from a <a href="http://sbr.ipmpipe.org/cgi-bin/sbr/county_info.cgi?date=2010-07-13&amp;pest=soybean_rust&amp;host=All%20Legumes/Kudzu">report on soy bean rust spread</a>.</p>

<p>Here are a few sample queries to get you started</p>

<p>1:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">select</span> <span style="color: #f92672">*</span> <span style="color: #66d9ef">from</span> <span style="color: #f8f8f2">html</span> <span style="color: #66d9ef">where</span> 
<span style="color: #f8f8f2">url</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;http://sbr.ipmpipe.org/cgi-bin/sbr/county_info.cgi?date=2010-07-13&amp;pest=soybean_rust&amp;host=All%20Legumes/Kudzu&quot;</span>
</pre></div>

This query just pulls all of the HML from the page. <a href="http://developer.yahoo.com/yql/console/#h=select%20*%20from%20html%20where%20url%3D%22http%3A//sbr.ipmpipe.org/cgi-bin/sbr/county_info.cgi%3Fdate%3D2010-07-13%26pest%3Dsoybean_rust%26host%3DAll%2520Legumes/Kudzu%22%0">Open in console</a>.</p>

<hr />

<p>2:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">select</span> <span style="color: #f92672">*</span> <span style="color: #66d9ef">from</span> <span style="color: #f8f8f2">html</span> <span style="color: #66d9ef">where</span> 
<span style="color: #f8f8f2">url</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;http://sbr.ipmpipe.org/cgi-bin/sbr/county_info.cgi?date=2010-07-13&amp;pest=soybean_rust&amp;host=All%20Legumes/Kudzu&quot;</span> 
<span style="color: #66d9ef">and</span> <span style="color: #f8f8f2">xpath</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;//table&#39;</span>
</pre></div>

This query extracts only the table element from the page. <a href="http://developer.yahoo.com/yql/console/#h=select%20*%20from%20html%20where%0Aurl%3D%22http%3A//sbr.ipmpipe.org/cgi-bin/sbr/county_info.cgi%3Fdate%3D2010-07-13%26pest%3Dsoybean_rust%26host%3DAll%2520Legumes/Kudzu%22%0Aand%20xpath%3D%27//table%27%0A">Open in console</a>.</p>

<hr />

<p>3:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">select</span> <span style="color: #f92672">*</span> <span style="color: #66d9ef">from</span> <span style="color: #f8f8f2">html</span> <span style="color: #66d9ef">where</span> 
<span style="color: #f8f8f2">url</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;http://sbr.ipmpipe.org/cgi-bin/sbr/county_info.cgi?date=2010-07-13&amp;pest=soybean_rust&amp;host=All%20Legumes/Kudzu&quot;</span> 
<span style="color: #66d9ef">and</span> <span style="color: #f8f8f2">xpath</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;//table/tr/td[2]&#39;</span>
</pre></div>

This query pulls the second item from each row of the table. <a href="http://developer.yahoo.com/yql/console/#h=select%20*%20from%20html%20where%0Aurl%3D%22http%3A//sbr.ipmpipe.org/cgi-bin/sbr/county_info.cgi%3Fdate%3D2010-07-13%26pest%3Dsoybean_rust%26host%3DAll%2520Legumes/Kudzu%22%20and%20xpath%3D%27//table/tr/td%5B2%5D%27">Open in console</a>.</p>

<hr />

<p>4:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">select</span> <span style="color: #f92672">*</span> <span style="color: #66d9ef">from</span> <span style="color: #f8f8f2">html</span> <span style="color: #66d9ef">where</span> 
<span style="color: #f8f8f2">url</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;http://www.mulvany.net/files/ipmsemanticpipe.html&quot;</span> 
<span style="color: #66d9ef">and</span> <span style="color: #f8f8f2">xpath</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;//table/tr/td[@id=&quot;status&quot; and p=&quot;Confirmed&quot;]/..&#39;</span>
</pre></div>

For this query I copied the table onto my own server and added some basic proto-semantic markup to the column descriptors.  I could then call out specific columns from the table. <a href="http://developer.yahoo.com/yql/console/#h=select%20*%20from%20html%20where%0Aurl%3D%22http%3A//www.mulvany.net/files/ipmsemanticpipe.html%22%0Aand%20xpath%3D%27//table/tr/td%5B@id%3D%22status%22%20and%20p%3D%22Confirmed%22%5D/..%27">Open in console</a>.</p>

<hr />

<p>5:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">select</span> <span style="color: #f92672">*</span> <span style="color: #66d9ef">from</span> <span style="color: #f8f8f2">csv</span> <span style="color: #66d9ef">WHERE</span> 
<span style="color: #f8f8f2">url</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;http://www.mulvany.net/files/ipmpipe.csv&quot;</span> 
<span style="color: #66d9ef">and</span> <span style="color: #f8f8f2">columns</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;date,place,status&#39;</span>
<span style="color: #66d9ef">and</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;Confirmed&#39;</span>
</pre></div>

With this query I converted the table into a csv file.  This demonstrates YQL&rsquo;s ability to query against csv files.  <a href="http://developer.yahoo.com/yql/console/#h=select%20*%20from%20csv%20WHERE%0Aurl%3D%22http%3A//www.mulvany.net/files/ipmpipe.csv%22%0Aand%20columns%3D%27date%2Cplace%2Cstatus%27%0Aand%20status%3D%27Confirmed%27">Open in console</a>.</p>

       </article>
 </div>

</body>
</html>

